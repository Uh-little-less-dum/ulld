{"version":3,"sources":["../../../src/utils/baseAppUtils/componentDocPathUtils.ts","../../../src/classes/query/componentDocs.ts"],"names":["path"],"mappings":"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","sourcesContent":["import path from \"path\";\nimport { BuildStaticDataOutput } from \"@ulld/types\";\nimport fs from \"fs\";\nimport { ComponentDocsQueryParams } from \"../../types/baseApp/componentDocsQuery.js\";\nimport { ComponentDocsQuery } from \"../../classes/query/componentDocs.js\";\n\nexport const componentDocsPathFromPluginComponent = (\n    pluginName: string,\n    componentName: string,\n    full: boolean = false,\n    projectRoot?: string,\n) => {\n    return path.join(\n        projectRoot || process.cwd(),\n        \"generatedMarkdown\",\n        \"componentDocs\",\n        full ? \"full\" : \"short\",\n        encodeURI(pluginName),\n        `${encodeURI(componentName)}.mdx`,\n    );\n};\n\n\nexport const componentDocQueryObjectToUrl = (query: ComponentDocsQueryParams) => {\n    let url = new URLSearchParams()\n    if(query.tag){\n        (Array.isArray(query.tag) ? query.tag : [query.tag]).forEach((t) => url.append(\"tag\", t))\n    }\n    if(query.full){\n        url.set(\"full\", \"true\")\n    }\n    if(query.query){\n        url.set(\"query\", query.query)\n    }\n    if(query.syntax){\n        url.set(\"syntax\", query.syntax)\n    }\n    if(query.pluginId){\n        url.set(\"pluginId\", query.pluginId)\n    }\n    return `/componentDocs?${url.toString()}`\n}\n\nexport const docItemToComponentDocsFilePath = (\n    item: BuildStaticDataOutput[\"componentDocs\"][number],\n    full: boolean = false,\n) => {\n    return componentDocsPathFromPluginComponent(\n        item.pluginName,\n        item.componentName,\n        full,\n    );\n};\n\nexport const getComponentDocsContentFromItem = async (\n    item: BuildStaticDataOutput[\"componentDocs\"][number],\n    full: boolean = false,\n) => {\n    let path = docItemToComponentDocsFilePath(item, full);\n    if (!path || !fs.existsSync(path)) {\n        return;\n    }\n    return await fs.promises.readFile(path, { encoding: \"utf-8\" });\n};\n\nexport const getItemsByQuery = (\n    buildData: BuildStaticDataOutput,\n    query: ComponentDocsQueryParams,\n) => {\n    let docQuery = new ComponentDocsQuery();\n    return docQuery.queryAll(buildData.componentDocs, query);\n};\n\nexport const getPluginDocContentByIds = async (\n    buildData: BuildStaticDataOutput,\n    pluginName: string,\n    componentName: string,\n    full: boolean = false,\n    permitOppositeOfFullIfNotFound: boolean = true\n) => {\n    let item = buildData.componentDocs.find((x) =>\n        Boolean(x.pluginName === pluginName && x.componentName === componentName),\n    );\n    if(item) {\n        let content = await getComponentDocsContentFromItem(item, full)\n        if(!content && permitOppositeOfFullIfNotFound){\n            content = await getComponentDocsContentFromItem(item, !full)\n        }\n        return {\n            item,\n            content\n        }\n    }\n};\n","import { BuildStaticDataOutput } from \"@ulld/types\";\nimport { ComponentDocsQueryParams } from \"../../types/baseApp/componentDocsQuery.js\";\ntype QueryItem = BuildStaticDataOutput[\"componentDocs\"][number];\n\nexport class ComponentDocsQuery {\n    constructor() { }\n    private itemMatchesSyntax(\n        item: QueryItem,\n        query: ComponentDocsQueryParams,\n    ): boolean {\n        if (query.syntax) {\n            if (\n                !item.embeddableSyntax.some((a) =>\n                    new RegExp(query.syntax!, \"gmi\").test(a),\n                )\n            ) {\n                return false;\n            }\n        }\n        return true;\n    }\n    private itemMatchesTag(item: QueryItem, query: ComponentDocsQueryParams) {\n        let tags = query.tag\n            ? Array.isArray(query.tag)\n                ? query.tag\n                : [query.tag]\n            : false;\n        if (!tags) {\n            return true;\n        } else if (!item.tags.length) {\n            return false;\n        }\n        let tl = tags.map((t) => t.toLowerCase());\n        return item.tags.some((a) => tl.includes(a.toLowerCase()));\n    }\n    private itemMatchesPluginId(\n        item: QueryItem,\n        query: ComponentDocsQueryParams,\n    ): boolean {\n        return query.pluginId ? item.pluginName === query.pluginId : true\n    }\n    private itemMatchesQuery(\n        item: QueryItem,\n        query: ComponentDocsQueryParams,\n    ): boolean {\n        if (!query.query) {\n            return true;\n        }\n        let re = new RegExp(query.query);\n        if (re.test(item.pluginName)) {\n            return true;\n        }\n        if (\n            item.embeddableSyntax.length &&\n            item.embeddableSyntax.some((x) => re.test(x))\n        ) {\n            return true;\n        }\n        if (re.test(item.componentName)) {\n            return true;\n        }\n        if (item.tags.length && item.tags.some((x) => re.test(x))) {\n            return true;\n        }\n        return false;\n    }\n\n    queryItem(item: QueryItem, query: ComponentDocsQueryParams) {\n        return [\n            this.itemMatchesPluginId,\n            this.itemMatchesTag,\n            this.itemMatchesQuery,\n            this.itemMatchesSyntax,\n        ].some((f) => f(item, query));\n    }\n    queryAll(items: QueryItem[], query: ComponentDocsQueryParams) {\n        return items.filter((x) => this.queryItem(x, query))\n    }\n}\n"]}